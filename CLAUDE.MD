# CLAUDE.MD - Alquemist Development Guide

**Version**: 5.0 | **Last Updated**: 2025-12-08

---

## Project Identity

**Alquemist** - Multi-region agricultural traceability SaaS for Cannabis, Coffee, Cocoa, and Flowers.

### Tech Stack

| Layer | Technology |
|-------|------------|
| Frontend | Next.js 15, React 19, TypeScript |
| Styling | Tailwind CSS, shadcn/ui |
| Backend | Convex (serverless) |
| Auth | Custom session tokens (30-day) |
| Email | Resend |

### Core Requirements
- Multi-tenant (company isolation)
- Batch-first tracking (50-1000 plants/batch)
- Mobile-first responsive
- Real-time updates (Convex subscriptions)

---

## Documentation System

### Para planear/implementar un modulo:

| Documento | Proposito |
|-----------|-----------|
| `docs/modules/phase-X/MXX-*.md` | Especificacion del modulo (user stories, criterios de aceptacion) |
| `docs/UI-PATTERNS.md` | Patrones de layout y UX |
| `convex/schema.ts` | Estructura de datos |

### Estructura de documentacion por modulo:

```
docs/modules/
â”œâ”€â”€ phase-2/           # Master Data âœ…
â”‚   â”œâ”€â”€ M08-area-management.md
â”‚   â”œâ”€â”€ M15-cultivar-management.md
â”‚   â”œâ”€â”€ M16-supplier-management.md
â”‚   â”œâ”€â”€ M17-team-management.md
â”‚   â”œâ”€â”€ M18-facility-management.md
â”‚   â”œâ”€â”€ M19-inventory-management.md
â”‚   â”œâ”€â”€ M20-facility-settings.md
â”‚   â””â”€â”€ M21-account-settings.md
â”œâ”€â”€ phase-3/           # Templates âœ…
â”‚   â”œâ”€â”€ M22-production-templates.md
â”‚   â””â”€â”€ M23-ai-quality-checks.md
â””â”€â”€ phase-4/           # Production ğŸ“
    â”œâ”€â”€ M24-production-orders.md
    â”œâ”€â”€ M25-batches.md
    â””â”€â”€ M26-plants.md
```

### Formato de cada documento de modulo:

```markdown
# Module XX: [Nombre]

## Overview
[1-2 parrafos describiendo el proposito]

## User Stories

### US-XX.1: [Titulo]
**Como** [rol]
**Quiero** [accion]
**Para** [beneficio]

**Criterios de Aceptacion:**
- [ ] AC1: ...
- [ ] AC2: ...

**Componentes:** [archivos relevantes]

---

## Schema (Tablas relacionadas)
## Integraciones
## Estados / Flujos
## API Backend
## Notas de Implementacion
```

---

## Phase Status

| Phase | Descripcion | Status |
|-------|-------------|--------|
| 1 | Onboarding & Auth | âœ… Completada |
| 2 | Master Data (Areas, Cultivars, Suppliers, Users, Inventory) | âœ… Completada |
| 3 | Templates Management | âœ… Completada |
| 4 | Production Workflows | ğŸ“ En documentacion |

### Phase 2 Modules:
- Module 8: Areas âœ…
- Module 15: Cultivars âœ…
- Module 16: Suppliers âœ…
- Module 17: Users âœ…
- Module 18: Facilities âœ…
- Module 19: Inventory âœ…
- Module 20: Facility Settings âœ…
- Module 21: Account Settings âœ…

### Phase 3 Modules:
- Module 22: Production Templates âœ…
- Module 23: AI Quality Checks âœ…

### Phase 4 Modules:
- Module 24: Production Orders ğŸ“
- Module 25: Batches ğŸ“
- Module 26: Plants ğŸ“

---

## UI/UX Principles

Ver `docs/UI-PATTERNS.md` para patrones detallados.

### Colores
- **CTAs (Crear/Guardar)**: `bg-amber-500 hover:bg-amber-600`
- **Estados activos**: `bg-green-700 hover:bg-green-800`
- **Status badges**: green/yellow/red segun estado

### Patrones de Pagina
- **Lista**: Dropdown filtro + Search + Boton crear (una linea)
- **Detalle**: Tabs con iconos (Detalle, Lotes, Actividades, Inventario)
- **Cards**: Clickeables â†’ navegan a detalle
- **Formularios**: Modal max-w-4xl con validacion Zod

### Responsive
- Mobile-first
- Grid: `lg:grid-cols-3 md:grid-cols-2`
- Botones: solo icono en mobile, texto en desktop

---

## Convex Backend

### Deployments
| Environment | URL | Usage |
|-------------|-----|-------|
| **Development** | https://exciting-shrimp-34.convex.cloud | Local development |
| **Production** | https://handsome-jay-388.convex.cloud | Vercel deployment |

**Current**: Development (exciting-shrimp-34)

### Auth Flow
1. Register â†’ Email verification â†’ Company setup â†’ Facility setup
2. Login â†’ Session token (30 days)
3. All requests: `Authorization: Bearer {token}`

### Multi-Tenant
- Cada registro tiene `company_id`
- Queries filtrados por company
- Session incluye company context

---

## Development Workflow

### Iniciar desarrollo de un modulo:

1. **Leer especificacion**: `docs/modules/phase-X/MXX-*.md`
2. **Revisar patrones UI**: `docs/UI-PATTERNS.md`
3. **Revisar schema**: `convex/schema.ts` (tabla relevante)
4. **Implementar**: Seguir patrones establecidos
5. **Validar**: Marcar criterios de aceptacion como completados

### Estructura de archivos por modulo:
```
app/(dashboard)/[module]/
â”œâ”€â”€ page.tsx              # Lista principal
â””â”€â”€ [id]/
    â”œâ”€â”€ page.tsx          # Detalle con tabs
    â””â”€â”€ edit/page.tsx     # Formulario edicion

components/[module]/
â”œâ”€â”€ [module]-list.tsx     # Componente de lista
â”œâ”€â”€ [module]-card.tsx     # Card individual
â”œâ”€â”€ [module]-create-modal.tsx
â””â”€â”€ [module]-*-tab.tsx    # Tabs de detalle
```

---

## Setup Instructions

### Development
```bash
npm install
npm run dev          # Next.js en http://localhost:3000
npx convex dev       # Solo si modificas backend
```

### Build & Deploy
```bash
npm run build
npm run start
```

### Code Quality
```bash
npm run lint
npx tsc --noEmit     # Type check
```

---

## Work Rules

### Principios
- **Simplicidad**: Cambios minimos necesarios
- **No scope creep**: Solo lo pedido
- **Root cause**: Arreglar el problema real
- **Production-ready**: Cada cambio debe ser deployable

### Antes de implementar
1. Leer especificacion del modulo
2. Leer codigo existente
3. Entender patrones establecidos

### Despues de implementar
- Verificar TypeScript: `npx tsc --noEmit`
- Probar funcionalidad manualmente
- Marcar criterios de aceptacion como completados
