# 2026-01-28

## [16:30] areas — M08 audit implementation
- **Files:** `convex/areas.ts`, `components/areas/area-card.tsx`, `components/areas/area-create-modal.tsx`, `app/(dashboard)/areas/[id]/edit/page.tsx`
- **Why:** Audit de M08 reveló gaps críticos de seguridad (auth guards faltantes), validación (nombres únicos), y UX (batch count hardcoded). Implementados fixes críticos e importantes.
- **Commit:** `99933e4`, `7f6f34c`, `82d57d9`

**Cambios implementados:**
1. Auth guards en todas las mutations (create, update, updateStatus, remove)
2. Validación de nombre único por instalación en create/update
3. Query getBatchCount para mostrar conteo real de lotes en cards
4. Mensajes de error mejorados mostrando errores del backend

**Pendiente:**
- Error boundaries (menor prioridad)
- Paginación en lista (menor prioridad)
- Lazy loading de tabs (menor prioridad)
- Campos de auditoría created_by/updated_by (menor prioridad)

## [19:19] cultivars — M15 audit implementation
- **Files:** `convex/cultivars.ts`, `components/cultivars/cultivar-list.tsx`, `components/cultivars/cultivar-card.tsx`, `app/(dashboard)/cultivars/[id]/edit/page.tsx`
- **Why:** Audit de M15 reveló gaps críticos de seguridad (auth guards faltantes en mutations y queries), validación (nombres únicos), y UX (toast faltantes, loading states, reactivate). Implementados todos los fixes críticos e importantes.
- **Commit:** `3e0427c`, `f09213f`, `9f1d8d5`, `61f3288`, `e4bb08f`, `32b3ffc`

**Cambios implementados:**
1. Auth guards en todas las mutations con verificación de company membership
2. Ownership validation en todas las queries (list, get, getByCrop, getByFacility)
3. Validación de nombre único por empresa (solo cultivares activos)
4. Input sanitization (.trim()) en todos los campos de texto
5. Toast notifications en edit page (reemplazando alert())
6. Error handling mejorado mostrando mensajes específicos del backend
7. Loading state durante delete (opacity + pointer-events-none)
8. Reactivate mutation para cultivares discontinued con UI completa

**Seguridad implementada:**
- Usuarios solo pueden CRUD cultivares de su empresa
- Queries verifican ownership antes de retornar datos
- Previene cross-company data leakage
- Validación dual: frontend (Zod) + backend (Convex)
