# 2026-01-27

## [--:--] dx — sistema de log diario y CLAUDE.md
- **Files:** `CLAUDE.md`, `.claude/skills/review-module/SKILL.md`, `docs/dev/logs/2026-01-27.md`
- **Why:** Establecer convencion de logging diario para contexto rapido de implementaciones y configurar instrucciones de proyecto.
- **Commit:** `pendiente`

## [--:--] products — auth, multi-tenant scoping, SKU prefix fixes
- **Files:** `convex/schema.ts`, `convex/products.ts`, `components/products/product-list.tsx`, `components/products/product-create-modal.tsx`, `components/products/product-form.tsx`, `components/inventory/product-combobox.tsx`, `components/inventory/inventory-form.tsx`, `app/(dashboard)/products/[id]/edit/product-edit-content.tsx`, `convex/seedOnboardingData.ts`, `convex/seedPhase2Data.ts`, `docs/modules/phase-2/M-product-management.md`
- **Why:** Audit del modulo de productos revelo gaps criticos de seguridad: sin auth en mutations, sin company_id scoping. Se agrego `company_id` al schema, `getAuthUserId` a todas las mutations, `companyId` como arg en queries, y se corrigieron prefijos SKU (PLN->PLT, VEG->MAT). Documentacion actualizada.
- **Commit:** `pendiente`

## [--:--] company-setup — M03 audit implementation
- **Files:** `convex/companies.ts`, `convex/registration.ts`, `app/(onboarding)/company-setup/page.tsx`, `app/(onboarding)/company-setup/actions.ts`, `app/(onboarding)/layout.tsx`, `lib/validations.ts`
- **Why:** Audit de M03 revelo: auth guards faltantes en backend, rol COMPANY_OWNER no asignado, UI no alineada con spec (titulo, boton, toast, progreso). Se agrego getAuthUserId a todas las funciones de companies, asignacion de COMPANY_OWNER en registro, toast de exito, boton amber-500, titulo correcto, y limpieza de console.logs.
- **Commit:** `0d8751d`, `06ba50e`, `7bae717`

## [--:--] facility-creation — M04 audit implementation
- **Files:** `convex/facilities.ts`, `convex/schema.ts`, `convex/seedOnboardingData.ts`, `app/(onboarding)/facility-location/page.tsx`, `app/(onboarding)/facility-location/actions.ts`, `app/(onboarding)/facility-basic/page.tsx`, `docs/modules/phase-1/M04-facility-creation.md`
- **Why:** Audit de M04 revelo: auth guards faltantes en todas las queries/mutations de facilities, tabla `facility_users` no existia en schema, campo `climate_zone` no se guardaba en DB, `skipLimitValidation` era parametro publico inseguro, campos opcionales marcados como requeridos en UI, faltaban 2 cultivares en seed data (3 de 5). Se corrigio todo y se actualizo documentacion.
- **Commit:** `d78f0f2`, `213f367`, `316f80a`, `a1a76dd`

## [--:--] home-dashboard — M05 audit implementation
- **Files:** `convex/home.ts`, `app/(dashboard)/dashboard/page.tsx`, `hooks/use-home-dashboard.ts`, `components/home/operative-dashboard.tsx`
- **Why:** Audit de M05 revelo: sin auth guards en las 4 queries, userId leido de cookie en vez de Convex Auth, full table scan de inventory_items, y badge de status hardcodeado. Se agrego getAuthUserId a todas las queries, se reemplazo cookie parsing por getCurrentUser, se optimizo con index by_area, se tipo QueryCtx, y se agrego badge dinamico.
- **Commit:** `501719a`

## [--:--] areas — M08 audit implementation
- **Files:** `convex/areas.ts`, `components/areas/area-form.tsx`, `components/areas/area-card.tsx`, `app/(dashboard)/areas/[id]/page.tsx`
- **Why:** Audit de M08 revelo: sin validacion de nombre unico por facility, formulario sin campos de dimensiones (largo/ancho/alto) ni area util, sin toggles de iluminacion/riego, boton submit verde en vez de amber-500, conteo de lotes hardcodeado a 0, y companyId obtenido via cookie en vez de provider. Se corrigio todo.
- **Commit:** `57a510f`, `5774067`, `9b2afc6`, `a170d75`, `9a2d33d`

## [--:--] user-invitation — M05 audit implementation
- **Files:** `convex/invitations.ts`, `convex/schema.ts`, `components/users/invite-user-modal.tsx`, `components/users/invitation-card.tsx`, `app/(auth)/accept-invitation/page.tsx`, `app/(auth)/welcome-invited/page.tsx`, `docs/modules/phase-1/M05-user-invitation.md`
- **Why:** Audit de M05 revelo: sin auth guards en funciones admin, helpers expuestos como mutations publicas, email no se enviaba al crear/reenviar invitacion, no se creaban facility_users al aceptar, cancel usaba status "rejected" en vez de "revoked", faltaban campos first_name/last_name en schema. Se convirtieron create/resend a actions con email via Resend, helpers a internalMutation, se agrego insercion de facility_users, auth guards, y se actualizo documentacion.
- **Commit:** `717d857`, `917237c`
